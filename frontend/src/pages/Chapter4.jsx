import { useEffect, useRef, useState } from 'react'
import { Link } from 'react-router-dom'
import './Chapter4.css'

function Chapter4() {
  const [showQuestions, setShowQuestions] = useState(false)
  const [isTestOpen, setIsTestOpen] = useState(false)
  const [isMusicPlaying, setIsMusicPlaying] = useState(false)
  const [selectedAnswers, setSelectedAnswers] = useState({})
  const [showResults, setShowResults] = useState(false)
  const [shuffledOptionsByQuestionId, setShuffledOptionsByQuestionId] = useState({})
  const audioRef = useRef({ audioContext: null, oscillator: null })
  
  const questions = [
    "–í —á—ë–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —Ñ–∞–∑—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏?",
    "–ö–∞–∫–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞?",
    "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º—ã–µ –Ω–∞ —Ñ–∞–∑–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ, —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–π –∏—Å—Ö–æ–¥–Ω–æ–π –∏–ª–∏ –∏–Ω–æ–π?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –º–∞—à–∏–Ω–Ω–æ-–∑–∞–≤–∏—Å–∏–º–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –º–∞—à–∏–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π?",
    "–í —á—ë–º –ø—Ä–∏–Ω—Ü–∏–ø —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å–∏–ª—ã –æ–ø–µ—Ä–∞—Ü–∏–π?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–±—â–∏–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Ü–∏–∫–ª–æ–≤?"
  ]

  const testQuestions = [
    {
      id: 1,
      question: '–í —á—ë–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —Ñ–∞–∑—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞?',
      options: {
        A: '–£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞',
        B: '–£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏/–∏–ª–∏ –æ–±—ä—ë–º–∞ –∫–æ–¥–∞',
        C: '–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –º–∞—à–∏–Ω–Ω—ã–π',
        D: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
      },
      correct: 'B',
    },
    {
      id: 2,
      question: '–ö–∞–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≠–í–ú?',
      options: {
        A: '–ú–∞—à–∏–Ω–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ',
        B: '–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ',
        C: '–ú–∞—à–∏–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ',
        D: '–†–µ–≥–∏—Å—Ç—Ä–æ–≤—ã–µ',
      },
      correct: 'C',
    },
    {
      id: 3,
      question: '–ö–∞–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã?',
      options: {
        A: '–ú–∞—à–∏–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ',
        B: '–õ–æ–≥–∏—á–µ—Å–∫–∏–µ',
        C: '–ú–∞—à–∏–Ω–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ',
        D: '–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ',
      },
      correct: 'C',
    },
    {
      id: 4,
      question: '–î–æ–ª–∂–Ω—ã –ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã?',
      options: {
        A: '–ù–µ—Ç, –¥–æ–ø—É—Å—Ç–∏–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞',
        B: '–î–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–π –∏—Å—Ö–æ–¥–Ω–æ–π',
        C: '–¢–æ–ª—å–∫–æ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π',
        D: '–¢–æ–ª—å–∫–æ –¥–ª—è —Ü–∏–∫–ª–æ–≤',
      },
      correct: 'B',
    },
    {
      id: 5,
      question: '–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–µ—Ä–∏–µ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞?',
      options: {
        A: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞',
        B: '–í—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏',
        C: '–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –æ–±—ä—ë–º –∫–æ–¥–∞',
        D: '–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞',
      },
      correct: 'C',
    },
    {
      id: 6,
      question: '–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–±—â–∏–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è?',
      options: {
        A: '–í—ã—Ä–∞–∂–µ–Ω–∏—è, –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑',
        B: '–í—ã—Ä–∞–∂–µ–Ω–∏—è, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞',
        C: '–í—ã—Ä–∞–∂–µ–Ω–∏—è, –≤—ã—á–∏—Å–ª—è—é—â–∏–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑',
        D: '–í—ã—Ä–∞–∂–µ–Ω–∏—è —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏',
      },
      correct: 'C',
    },
    {
      id: 7,
      question: '–í —á—ë–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—â–∏—Ö –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π?',
      options: {
        A: '–£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö',
        B: '–ó–∞–º–µ–Ω–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏',
        C: '–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–Ω–µ–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞',
        D: '–ü–µ—Ä–µ–Ω–æ—Å –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ –Ω–∞—á–∞–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
      },
      correct: 'C',
    },
    {
      id: 8,
      question: '–ù–∞ –∫–∞–∫–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±—ã—á–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –æ–±—â–∏–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è?',
      options: {
        A: '–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç',
        B: '–ú–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥',
        C: '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ',
        D: '–û–±—ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥',
      },
      correct: 'C',
    },
    {
      id: 9,
      question: '–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —Ü–∏–∫–ª–∞?',
      options: {
        A: '–í—ã—Ä–∞–∂–µ–Ω–∏–µ, –∏–∑–º–µ–Ω—è—é—â–µ–µ—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏',
        B: '–í—ã—Ä–∞–∂–µ–Ω–∏–µ, –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞',
        C: '–£—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–∏–∫–ª–∞',
        D: '–¢–µ–ª–æ —Ü–∏–∫–ª–∞',
      },
      correct: 'B',
    },
    {
      id: 10,
      question: '–í —á—ë–º —Å–æ—Å—Ç–æ–∏—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ü–∏–∫–ª–∞?',
      options: {
        A: '–£–¥–∞–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞',
        B: '–ü–µ—Ä–µ–Ω–æ—Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Ü–∏–∫–ª–∞',
        C: '–ó–∞–º–µ–Ω–∞ —Ü–∏–∫–ª–∞ —Ä–µ–∫—É—Ä—Å–∏–µ–π',
        D: '–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π',
      },
      correct: 'B',
    },
    {
      id: 11,
      question: '–ü–æ—á–µ–º—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ü–∏–∫–ª–∞ –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞?',
      options: {
        A: '–¶–∏–∫–ª—ã —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è',
        B: '–¶–∏–∫–ª—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑',
        C: '–û—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ü–∏–∫–ª—ã',
        D: '–£–º–µ–Ω—å—à–∞–µ—Ç—Å—è –æ–±—ä—ë–º –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞',
      },
      correct: 'C',
    },
    {
      id: 12,
      question: '–ö –∫–∞–∫–æ–º—É —Ç–∏–ø—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π?',
      options: {
        A: '–ú–∞—à–∏–Ω–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–º',
        B: '–ú–∞—à–∏–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º',
        C: '–ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–º',
        D: '–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–º',
      },
      correct: 'B',
    },
  ]

  const shuffleArray = (arr) => {
    const a = [...arr]
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1))
      ;[a[i], a[j]] = [a[j], a[i]]
    }
    return a
  }

  const openTest = () => {
    setSelectedAnswers({})
    setShowResults(false)
    setIsTestOpen(true)

    const shuffled = {}
    testQuestions.forEach((q) => {
      shuffled[q.id] = shuffleArray(Object.entries(q.options))
    })
    setShuffledOptionsByQuestionId(shuffled)
  }

  const stopMusic = () => {
    const { oscillator, audioContext } = audioRef.current || {}
    try {
      if (oscillator) oscillator.stop()
    } catch {
      // ignore
    }
    try {
      if (audioContext) audioContext.close()
    } catch {
      // ignore
    }
    audioRef.current = { audioContext: null, oscillator: null }
    setIsMusicPlaying(false)
  }

  const startMusic = async () => {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)()
      const oscillator = audioContext.createOscillator()
      const gainNode = audioContext.createGain()

      oscillator.connect(gainNode)
      gainNode.connect(audioContext.destination)

      oscillator.frequency.value = 220
      oscillator.type = 'sine'
      gainNode.gain.value = 0.03

      oscillator.start()
      audioRef.current = { audioContext, oscillator }
      setIsMusicPlaying(true)
    } catch (e) {
      console.log('Audio not supported', e)
    }
  }

  const handleMusicToggle = () => {
    if (isMusicPlaying) {
      stopMusic()
      return
    }
    startMusic()
  }

  const handleAnswerSelect = (questionId, answer) => {
    setSelectedAnswers((prev) => ({
      ...prev,
      [questionId]: answer,
    }))
  }

  const handleSubmitTest = () => {
    setShowResults(true)
  }

  const handleCloseTest = () => {
    setIsTestOpen(false)
    setShowResults(false)
    setSelectedAnswers({})
    setShuffledOptionsByQuestionId({})
    stopMusic()
  }

  const getScore = () => {
    let correct = 0
    testQuestions.forEach((q) => {
      if (selectedAnswers[q.id] === q.correct) {
        correct++
      }
    })
    return correct
  }

  const allAnswered = testQuestions.every((q) => selectedAnswers[q.id])

  useEffect(() => {
    return () => stopMusic()
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [])

  return (
    <div className="chapter4">
      <div className="container">
        <nav className="breadcrumb">
          <Link to="/">–ì–ª–∞–≤–Ω–∞—è</Link> / 4. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ö–û–î–ê
        </nav>
        
        <h1>4. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ö–û–î–ê</h1>
        
        <div className="chapter-plan">
          <h2>–ü–ª–∞–Ω:</h2>
          <ol>
            <li>–ú–∞—à–∏–Ω–Ω–æ-–∑–∞–≤–∏—Å–∏–º–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.</li>
            <li>–ú–∞—à–∏–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è.</li>
            <li>–ú–µ—Ç–æ–¥—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞.</li>
          </ol>
          <p className="keywords">
            <strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> –æ–±—â–∏–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è, –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Ü–∏–∫–ª–∞.
          </p>
        </div>

        <section className="chapter-section">
          <p>
            –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –º–∞—à–∏–Ω–Ω–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –ú—ã –Ω–µ –±—É–¥–µ–º —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ –∏–∑ —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –¥–∞–¥–∏–º —Å–ª–æ–≤–µ—Å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ –¥–µ—Ç–∞–ª–∏, –∫–∞—Å–∞—é—â–∏–µ—Å—è —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤, –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ä–∞–±–æ—Ç–∞—Ö [2, 3].
          </p>
          <p>
            –û–¥–Ω–∏–º –∏–∑ –≤–∞–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –≤—ã—á–∏—Å–ª—è—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:
          </p>
          <div className="code-block">
            <pre>{`VAR x,y: ARRAY [1..10,1..10] OF INTEGER;
‚Ä¶ FOR i := 1 TO 10 DO
x [ i , 2*j-1 ] := y [ i , 2*j ];
‚Ä¶`}</pre>
          </div>
          <p>
            –í—ã—Ä–∞–∂–µ–Ω–∏–µ 2*j —è–≤–ª—è–µ—Ç—Å—è –æ–±—â–∏–º –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—â–∏–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –≤—ã—á–∏—Å–ª—è—é—â–∏–π —ç—Ç–æ —É–º–Ω–æ–∂–µ–Ω–∏–µ, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö.
          </p>
          <p>
            –û–±—â–∏–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è –æ–±—ã—á–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π —Ñ–æ—Ä–º—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã (—Ä–∏—Å. 19). –°–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å 161 –æ–ø–µ—Ä–∞—Ü–∏—é.
          </p>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 19.png" alt="–†–∏—Å—É–Ω–æ–∫ 19" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 19</p>
          </div>
          <p>
            –ï—Å–ª–∏ –º—ã –∏—Å—Å–ª–µ–¥—É–µ–º —ç—Ç—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ç–≤—ë—Ä–æ–∫, —Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏–º, —á—Ç–æ —á–µ—Ç–≤—ë—Ä–∫–∏ 5 –∏ 11 —Å–æ–≤–ø–∞–¥–∞—é—Ç, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –∏–º–µ–Ω–∏ –ø–æ–ª—É—á–∞–µ–º–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –æ–ø–µ—Ä–∞–Ω–¥ j –Ω–µ –º–µ–Ω—è–µ—Ç —Å–≤–æ–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ–∂–¥—É —á–µ—Ç–≤—ë—Ä–∫–∞–º–∏ 5 –∏ 11.
          </p>
          <p>
            –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ—Å—Ç–∏—á—å —á–µ—Ç–≤—ë—Ä–∫–∏ 11, –Ω–µ –ø—Ä–æ—Ö–æ–¥—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ç–≤—ë—Ä–∫—É 5, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –Ω–∞ –æ–¥–Ω–æ–º –ª–∏–Ω–µ–π–Ω–æ–º —É—á–∞—Å—Ç–∫–µ.
          </p>
          <p>
            –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á–µ—Ç–≤—ë—Ä–∫–∏ 5 –∏ 11 –≤—ã—á–∏—Å–ª—è—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ–∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ–º —É–¥–∞–ª–∏—Ç—å —á–µ—Ç–≤—ë—Ä–∫—É 11 –∏ –∑–∞–º–µ–Ω–∏—Ç—å –ª—é–±—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –µ—ë —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É (i9) –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π i3, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —á–µ—Ç–≤—ë—Ä–∫–∏ 5. –≠—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è 2*j, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –≤—ã–¥–µ–ª–∏–ª–∏ –∫–∞–∫ –æ–±—â–µ–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –∏—Å—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.
          </p>
          <p>
            –ü–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã i3 –Ω–∞ i10 –º—ã –æ–±–Ω–∞—Ä—É–∂–∏–º, —á—Ç–æ —á–µ—Ç–≤—ë—Ä–∫–∏ 6 –∏ 12 —Ç–∞–∫–∂–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –∏–º–µ–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –º—ã –º–æ–∂–µ–º —É–¥–∞–ª–∏—Ç—å —á–µ—Ç–≤—ë—Ä–∫—É 12 –∏ –∑–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é i11 –≤—Å—é–¥—É, –≥–¥–µ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é i4. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —á–µ—Ç–≤—ë—Ä–∫–∏ 10 –∏ 11 —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã —á–µ—Ç–≤—ë—Ä–∫–∞–º 3 –∏ 4. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏–º –Ω–æ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ç–≤—ë—Ä–æ–∫ (—Ä–∏—Å. 20), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ 121 –æ–ø–µ—Ä–∞—Ü–∏–∏.
          </p>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 20.png" alt="–†–∏—Å—É–Ω–æ–∫ 20" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 20</p>
          </div>
          <p>
            –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ—Ç–≤—ë—Ä–æ–∫ —Å–æ–∫—Ä–∞—â–µ–Ω–æ —Å 17 –¥–æ 13. –ü–æ—Å–∫–æ–ª—å–∫—É –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–æ –≤—Å–µ—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–¥–µ—Å—å —á–µ—Ç–≤—ë—Ä–∫–∞—Ö –∑–∞–π–º—É—Ç, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ–±—ã—á–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, —Ç–æ –º—ã —Ç–∞–∫–∂–µ —Å–æ–∫—Ä–∞—Ç–∏–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã.
          </p>
          <p>
            –î—Ä—É–≥–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ü–∏–∫–ª–∞. –¢–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞, —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç –æ–¥–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∫ –¥—Ä—É–≥–æ–π. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º –≤ —Ç–µ–ª–æ —Ü–∏–∫–ª–∞ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª—è—Ç—å –∏—Ö –∑–∞–Ω–æ–≤–æ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–µ–π. –ü–æ—Å–∫–æ–ª—å–∫—É –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–º –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤, —ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –ø–æ–¥–æ–±–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–µ—Å—å–º–∞ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π.
          </p>
          <p>
            <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å 94 –æ–ø–µ—Ä–∞—Ü–∏–∏.
          </p>
          <p>
            –ü—Ä–∏–º–µ—Ä–æ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ü–∏–∫–ª–∞ —è–≤–ª—è–µ—Ç—Å—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è 2*j. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –æ–ø–µ—Ä–∞–Ω–¥–∞ j, –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–∏–∫–ª–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –º–æ–∂–µ–º –ø–æ–º–µ—Å—Ç–∏—Ç—å —á–µ—Ç–≤—ë—Ä–∫—É 5 –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–∏–∫–ª–∞. –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ç–≤—ë—Ä–æ–∫ 6 –∏ 7.
          </p>
          <p>
            –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏–º –Ω–æ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ç–≤—ë—Ä–æ–∫ (—Ä–∏—Å. 21). –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ—Ç–≤—ë—Ä–æ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–µ–º –∂–µ, –Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ—Ç–≤—ë—Ä–æ–∫ –≤ —Ü–∏–∫–ª–µ —É–º–µ–Ω—å—à–∏–ª–æ—Å—å —Å 12 –¥–æ 9. –ö–∞–∂–¥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è FOR –≤—ã–∑—ã–≤–∞–µ—Ç –¥–µ—Å—è—Ç–∏–∫—Ä–∞—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–ª–∞ —Ü–∏–∫–ª–∞. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è FOR, —Å–æ–∫—Ä–∞—Ç–∏–ª–æ—Å—å —Å–æ 121 –¥–æ 94.
          </p>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 21.png" alt="–†–∏—Å—É–Ω–æ–∫ 21" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 21</p>
          </div>
          <p>
            –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π, –ø—Ä–∏—Ö–æ–¥—è—â–∏—Ö—Å—è –Ω–∞ –æ–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è FOR, –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —Å–æ–∫—Ä–∞—Ç–∏–ª–æ—Å—å —Å–æ 161 –¥–æ 94, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∏–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
          </p>
          <p>
            –°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ –∏ –±–æ–ª–µ–µ —Ç–æ–Ω–∫–∏–µ –º–µ—Ç–æ–¥—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±—â–∏—Ö –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ü–∏–∫–ª–∞, —á–µ–º –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤—ã—à–µ. –ú–æ–∂–Ω–æ –æ–∂–∏–¥–∞—Ç—å, —á—Ç–æ –±–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–∏–º –º–µ—Ç–æ–¥–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω –µ—â—ë –±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ–¥–∞.
          </p>
        </section>

        <div className="questions-section">
          <button 
            className="questions-btn"
            onClick={() => setShowQuestions(!showQuestions)}
          >
            {showQuestions ? '‚ñº' : '‚ñ∂'} –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
          </button>
          
          {showQuestions && (
            <div className="questions-content">
              <ol className="questions-list">
                {questions.map((question, index) => (
                  <li key={index}>{question}</li>
                ))}
              </ol>
            </div>
          )}

          <button className="btn test-btn" onClick={openTest}>
            –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
          </button>
        </div>

        {isTestOpen && (
          <div className="test-modal-overlay" onClick={handleCloseTest}>
            <div className="test-modal" onClick={(e) => e.stopPropagation()}>
              <div className="test-modal-header">
                <h2>–¢–µ—Å—Ç –ø–æ —Ç–µ–º–µ ¬´–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞¬ª</h2>
                <button className="close-btn" onClick={handleCloseTest}>√ó</button>
              </div>

              <div className="test-music-control">
                <button
                  className={`music-btn ${isMusicPlaying ? 'playing' : ''}`}
                  onClick={handleMusicToggle}
                >
                  {isMusicPlaying ? 'üîä –ú—É–∑—ã–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞' : 'üîá –ú—É–∑—ã–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞'}
                </button>
              </div>

              <div className="test-content">
                {testQuestions.map((q) => (
                  <div key={q.id} className="test-question">
                    <h3>{q.id}. {q.question}</h3>
                    <div className="test-options">
                      {(shuffledOptionsByQuestionId[q.id] || Object.entries(q.options)).map(([key, value]) => {
                        const isSelected = selectedAnswers[q.id] === key
                        const isCorrect = q.correct === key
                        const showAnswer = showResults
                        return (
                          <label
                            key={key}
                            className={`test-option ${isSelected ? 'selected' : ''} ${showAnswer && isCorrect ? 'correct' : ''} ${showAnswer && isSelected && !isCorrect ? 'incorrect' : ''}`}
                          >
                            <input
                              type="radio"
                              name={`question-${q.id}`}
                              value={key}
                              checked={isSelected}
                              onChange={() => handleAnswerSelect(q.id, key)}
                              disabled={showResults}
                            />
                            <span>{value}</span>
                            {showAnswer && isCorrect && <span className="correct-mark">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</span>}
                          </label>
                        )
                      })}
                    </div>
                  </div>
                ))}
              </div>

              <div className="test-footer">
                {!showResults ? (
                  <button
                    className="btn submit-btn"
                    onClick={handleSubmitTest}
                    disabled={!allAnswered}
                  >
                    –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
                  </button>
                ) : (
                  <div className="test-results">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h3>
                    <p className="test-score">
                      –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {getScore()} –∏–∑ {testQuestions.length}
                    </p>
                    <p className="test-percentage">
                      {Math.round((getScore() / testQuestions.length) * 100)}%
                    </p>
                    <button className="btn" onClick={handleCloseTest}>
                      –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
        
        <div className="chapter-navigation">
          <Link to="/" className="btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</Link>
        </div>
      </div>
    </div>
  )
}

export default Chapter4


