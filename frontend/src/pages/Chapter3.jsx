import { useEffect, useRef, useState } from 'react'
import { Link } from 'react-router-dom'
import './Chapter3.css'

function Chapter3() {
  const [showQuestions, setShowQuestions] = useState(false)
  const [isTestOpen, setIsTestOpen] = useState(false)
  const [isMusicPlaying, setIsMusicPlaying] = useState(false)
  const [selectedAnswers, setSelectedAnswers] = useState({})
  const [showResults, setShowResults] = useState(false)
  const [shuffledOptionsByQuestionId, setShuffledOptionsByQuestionId] = useState({})
  const audioRef = useRef({ audioContext: null, oscillator: null })
  
  const questions = [
    "–í –∫–∞–∫–æ–º —Ç–∏–ø–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–∞–∂–¥—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Ç–∞–±–ª–∏—Ü—ã, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π?",
    "–°–∫–æ–ª—å–∫–æ (–º–∞–∫—Å–∏–º—É–º) —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ç—Ä–µ–±—É–µ—Ç –¥–ª—è n = 128 —ç–ª–µ–º–µ–Ω—Ç–æ–≤?",
    "–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ–º p1 = 1, p2 = 2, p3 = 3 –∏ —Ç.–¥.?",
    "–í —ç—Ç–æ–º —Ç–∏–ø–µ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è pi = i*h, –≥–¥–µ h ‚Äì –∏—Å—Ö–æ–¥–Ω—ã–π —Ö–µ—à-–∏–Ω–¥–µ–∫—Å.",
    "–ö–∞–∫–æ–µ –ø–æ–ª–µ –≤ –º–µ—Ç–æ–¥–µ —Ü–µ–ø–æ—á–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–≤—è–∑–∞—Ç—å –≤ —Ü–µ–ø–æ—á–∫—É —ç–ª–µ–º–µ–Ω—Ç—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É –∂–µ —Å–∞–º–æ–º—É —É–∫–∞–∑–∞—Ç–µ–ª—é?",
    "–î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–∞ –∫–æ–¥–∏—Ä–æ–≤–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞?",
    "–î–ª—è —á–µ–≥–æ —Å–ª—É–∂–∏—Ç —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤?",
    "–ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤?",
    "–í —á—ë–º —Å–æ—Å—Ç–æ–∏—Ç –º–µ—Ç–æ–¥ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ?",
    "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫?",
    "–ö–∞–∫–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–ø–æ—Å–æ–±—ã —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è?",
    "–ö–∞–∫ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü —Å–∏–º–≤–æ–ª–æ–≤?",
    "–í —á—ë–º —Å—É—Ç—å –º–µ—Ç–æ–¥–æ–≤ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö –≤—Å—Ç–∞–≤–æ–∫?",
    "–ö–∞–∫–æ–≤—ã –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞ —Ö–µ—à-–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –∏ –∫–∞–∫–æ–≤—ã –µ—ë –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏?",
    "–ö–∞–∫–∏–µ –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–ø–æ—Å–æ–±—ã —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è?",
    "–í —á—ë–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–∞ —Ü–µ–ø–æ—á–µ–∫ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º?",
    "–ö–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–∏–º–≤–æ–ª–æ–≤?",
    "–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö?"
  ]

  const testQuestions = [
    {
      id: 1,
      question: '–ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã —Å–∏–º–≤–æ–ª–æ–≤ —Ç—Ä–µ–±—É–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–∞–∂–¥—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –ø–æ–∏—Å–∫–µ?',
      options: {
        A: '–•–µ—à-–∞–¥—Ä–µ—Å–∞—Ü–∏—è',
        B: '–ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫',
        C: '–ù–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞',
        D: '–ú–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫',
      },
      correct: ['C'],
    },
    {
      id: 2,
      question: '–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –∏–∑ N —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–∞–≤–Ω–æ:',
      options: {
        A: 'N',
        B: 'N/2',
        C: 'log‚ÇÇN',
        D: '1',
      },
      correct: ['B'],
    },
    {
      id: 3,
      question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ —Å–∏–º–≤–æ–ª–æ–≤?',
      options: {
        A: '–õ–∏–Ω–µ–π–Ω—ã–π –ø–æ–∏—Å–∫',
        B: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫',
        C: '–ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫',
        D: '–•–µ—à-–ø–æ–∏—Å–∫',
      },
      correct: ['C'],
    },
    {
      id: 4,
      question: '–°–∫–æ–ª—å–∫–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–∏–Ω–∞—Ä–Ω–æ–º—É –ø–æ–∏—Å–∫—É –ø—Ä–∏ n = 128?',
      options: {
        A: '6',
        B: '7',
        C: '8',
        D: '128',
      },
      correct: ['C'],
    },
    {
      id: 5,
      question: '–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤?',
      options: {
        A: '–¢–∞–±–ª–∏—Ü–∞ –º–∞—à–∏–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤',
        B: '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫',
        C: '–¢–∞–±–ª–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ —è–∑—ã–∫–∞',
        D: '–¢–∞–±–ª–∏—Ü–∞ –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞',
      },
      correct: ['B'],
    },
    {
      id: 6,
      question: '–ö–∞–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–∏–º–≤–æ–ª–æ–≤?',
      options: {
        A: '–¢–æ–ª—å–∫–æ –∏–º–µ–Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤',
        B: '–¢–æ–ª—å–∫–æ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö',
        C: '–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏',
        D: '–¢–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞ –≤ –ø–∞–º—è—Ç–∏',
      },
      correct: ['C'],
    },
    {
      id: 7,
      question: '–•–µ—à-–∞–¥—Ä–µ—Å–∞—Ü–∏—è –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤:',
      options: {
        A: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É',
        B: '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ç–∞–±–ª–∏—Ü—ã',
        C: '–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ —Å–∏–º–≤–æ–ª–∞ –≤ –∏–Ω–¥–µ–∫—Å —Ç–∞–±–ª–∏—Ü—ã',
        D: '–î–µ–ª–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –±–ª–æ–∫–∏',
      },
      correct: ['C'],
    },
    {
      id: 8,
      question: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∏–º–≤–æ–ª–∞ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö–µ—à-–∏–Ω–¥–µ–∫—Å?',
      options: {
        A: '–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ',
        B: '–ö–æ–Ω—Ñ–ª–∏–∫—Ç',
        C: '–ö–æ–ª–ª–∏–∑–∏—è',
        D: '–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ',
      },
      correct: ['C'],
    },
    {
      id: 9,
      question: '–ö–∞–∫–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π?',
      options: {
        A: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞',
        B: '–†–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
        C: '–ú–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫',
        D: '–ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫',
      },
      correct: ['B', 'C'],
    },
    {
      id: 10,
      question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—ë—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é p‚ÇÅ = 1, p‚ÇÇ = 2, p‚ÇÉ = 3, ‚Ä¶ ?',
      options: {
        A: '–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
        B: '–õ–∏–Ω–µ–π–Ω–æ–µ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
        C: '–î–≤–æ–π–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
        D: '–°–ª—É—á–∞–π–Ω–æ–µ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ',
      },
      correct: ['B'],
    },
    {
      id: 11,
      question: '–í –∫–∞–∫–æ–º –º–µ—Ç–æ–¥–µ —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞ p·µ¢ = i ¬∑ h, –≥–¥–µ h ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π —Ö–µ—à-–∏–Ω–¥–µ–∫—Å?',
      options: {
        A: '–õ–∏–Ω–µ–π–Ω–æ–µ',
        B: '–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ',
        C: '–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ',
        D: '–î–≤–æ–π–Ω–æ–µ',
      },
      correct: ['C'],
    },
    {
      id: 12,
      question: '–ö–∞–∫–æ–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ —Ü–µ–ø–æ—á–µ–∫ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤?',
      options: {
        A: 'HASH',
        B: 'NEXT',
        C: 'CHAIN',
        D: 'LINK',
      },
      correct: ['C'],
    },
    {
      id: 13,
      question: '–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —è—á–µ–π–∫–µ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–∞ —Ü–µ–ø–æ—á–µ–∫?',
      options: {
        A: '–ó–Ω–∞—á–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞',
        B: '–ê–¥—Ä–µ—Å –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ü–µ–ø–æ—á–∫–∏',
        C: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤',
        D: '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö',
      },
      correct: ['B'],
    },
    {
      id: 14,
      question: '–í —á—ë–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –º–µ—Ç–æ–¥–∞ —Ü–µ–ø–æ—á–µ–∫ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º?',
      options: {
        A: '–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—è',
        B: '–ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –∫–æ–ª–ª–∏–∑–∏–∏',
        C: '–¢–∞–±–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç–∏',
        D: '–ü—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è',
      },
      correct: ['C'],
    },
    {
      id: 15,
      question: '–ö–æ–≥–¥–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏?',
      options: {
        A: '–ü–æ—Å–ª–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞',
        B: '–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞',
        C: '–í –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤',
        D: '–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏',
      },
      correct: ['C'],
    },
  ]

  const shuffleArray = (arr) => {
    const a = [...arr]
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1))
      ;[a[i], a[j]] = [a[j], a[i]]
    }
    return a
  }

  const openTest = () => {
    setSelectedAnswers({})
    setShowResults(false)
    setIsTestOpen(true)

    const shuffled = {}
    testQuestions.forEach((q) => {
      shuffled[q.id] = shuffleArray(Object.entries(q.options))
    })
    setShuffledOptionsByQuestionId(shuffled)
  }

  const stopMusic = () => {
    const { oscillator, audioContext } = audioRef.current || {}
    try {
      if (oscillator) oscillator.stop()
    } catch {
      // ignore
    }
    try {
      if (audioContext) audioContext.close()
    } catch {
      // ignore
    }
    audioRef.current = { audioContext: null, oscillator: null }
    setIsMusicPlaying(false)
  }

  const startMusic = async () => {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)()
      const oscillator = audioContext.createOscillator()
      const gainNode = audioContext.createGain()

      oscillator.connect(gainNode)
      gainNode.connect(audioContext.destination)

      oscillator.frequency.value = 220
      oscillator.type = 'sine'
      gainNode.gain.value = 0.03

      oscillator.start()
      audioRef.current = { audioContext, oscillator }
      setIsMusicPlaying(true)
    } catch (e) {
      console.log('Audio not supported', e)
    }
  }

  const handleMusicToggle = () => {
    if (isMusicPlaying) {
      stopMusic()
      return
    }
    startMusic()
  }

  const handleAnswerSelect = (questionId, answer) => {
    setSelectedAnswers((prev) => ({
      ...prev,
      [questionId]: answer,
    }))
  }

  const handleAnswerToggle = (questionId, answer) => {
    setSelectedAnswers((prev) => {
      const current = prev[questionId] || []
      const exists = current.includes(answer)
      const next = exists ? current.filter((a) => a !== answer) : [...current, answer]
      return { ...prev, [questionId]: next }
    })
  }

  const handleSubmitTest = () => {
    setShowResults(true)
  }

  const handleCloseTest = () => {
    setIsTestOpen(false)
    setShowResults(false)
    setSelectedAnswers({})
    setShuffledOptionsByQuestionId({})
    stopMusic()
  }

  const getScore = () => {
    let correct = 0
    testQuestions.forEach((q) => {
      const expected = Array.isArray(q.correct) ? q.correct : [q.correct]
      const picked = selectedAnswers[q.id]
      if (Array.isArray(picked)) {
        const allIncluded = expected.length === picked.length && expected.every((v) => picked.includes(v))
        if (allIncluded) correct++
      } else if (picked && expected.length === 1 && expected[0] === picked) {
        correct++
      }
    })
    return correct
  }

  const allAnswered = testQuestions.every((q) => {
    const picked = selectedAnswers[q.id]
    if (Array.isArray(q.correct)) {
      return Array.isArray(picked) && picked.length > 0
    }
    return Boolean(picked)
  })

  useEffect(() => {
    return () => stopMusic()
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [])

  return (
    <div className="chapter3">
      <div className="container">
        <nav className="breadcrumb">
          <Link to="/">–ì–ª–∞–≤–Ω–∞—è</Link> / 3. –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶ –°–ò–ú–í–û–õ–û–í
        </nav>
        
        <h1>3. –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶ –°–ò–ú–í–û–õ–û–í</h1>
        
        <div className="chapter-plan">
          <h2>–ü–ª–∞–Ω:</h2>
          <ol>
            <li>–°–ø–æ—Å–æ–±—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü —Å–∏–º–≤–æ–ª–æ–≤.</li>
            <li>–ù–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.</li>
            <li>–•–µ—à-–∞–¥—Ä–µ—Å–∞—Ü–∏—è.</li>
            <li>–†–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ.</li>
            <li>–ú–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫.</li>
          </ol>
          <p className="keywords">
            <strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤, –ø–æ–∏—Å–∫, –∫–æ–ª–ª–∏–∑–∏—è.
          </p>
        </div>

        <section className="chapter-section">
          <h2>3.1. –°–ü–û–°–û–ë–´ –û–†–ì–ê–ù–ò–ó–ê–¶–ò–ò –¢–ê–ë–õ–ò–¶ –°–ò–ú–í–û–õ–û–í</h2>
          <p>
            –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —Ç—Ä–µ–±—É—é—Ç –∑–Ω–∞–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–º —è–∑—ã–∫–µ. –≠—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤—ã—è—Å–Ω—è—é—Ç—Å—è –∏–∑ –æ–ø–∏—Å–∞–Ω–∏–π –∏ –∏–∑ —Ç–æ–≥–æ, –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö —Å–∏–º–≤–æ–ª–æ–≤.
          </p>
          <p>
            –¢–∞–±–ª–∏—Ü—ã –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–º–µ—é—Ç –æ–±—â–∏–π –≤–∏–¥ (—Ç–∞–±–ª. 6). –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —Ç–∞–±–ª–∏—Ü—ã —è–≤–ª—è—é—Ç—Å—è —Å–∏–º–≤–æ–ª—ã –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –∞ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ ‚Äì –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –ö–æ–≥–¥–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∏—Å—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã, —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤ –ø—É—Å—Ç–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–ª—É–∂–µ–±–Ω—ã—Ö —Å–ª–æ–≤ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, –Ω–æ –ø–æ–∏—Å–∫ –≤–µ–¥—ë—Ç—Å—è –≤—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —ç—Ç–æ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –¢–∞–∫ –∫–∞–∫ –Ω–∞ —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å —É—Ö–æ–¥–∏—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –≤–∞–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–∞–∫—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é —Ç–∞–±–ª–∏—Ü, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ø—É—Å–∫–∞–ª–∞ –±—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫.
          </p>
          <div className="image-container">
            <img src="/images/—Ç–∞–±–ª–∏—Ü–∞ 6.png" alt="–¢–∞–±–ª–∏—Ü–∞ 6" className="chapter-image" />
            <p className="image-caption">–¢–∞–±–ª–∏—Ü–∞ 6</p>
          </div>
          <div className="image-container">
            <img src="/images/—Ç–∞–±–ª–∏—Ü–∞ 7.png" alt="–¢–∞–±–ª–∏—Ü–∞ 7" className="chapter-image" />
            <p className="image-caption">–¢–∞–±–ª–∏—Ü–∞ 7</p>
          </div>
          <p>
            –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–ø–æ—Å–æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø–æ–ø—ã—Ç–æ–∫ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏—è. –ü–æ–∏—Å–∫ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∫–∞–∂–¥—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Ç–∞–±–ª–∏—Ü—ã, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π. –î–ª—è —Ç–∞–±–ª–∏—Ü—ã, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π N —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤ —Å—Ä–µ–¥–Ω–µ–º –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ N/2 —Å—Ä–∞–≤–Ω–µ–Ω–∏–π. –ï—Å–ª–∏ N –≤–µ–ª–∏–∫–æ, —Ç–∞–∫–æ–π —Å–ø–æ—Å–æ–± –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω. –ü–æ–∏—Å–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–±–ª–∏—Ü—ã —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞–∏–±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —è–≤–ª—è–µ—Ç—Å—è —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏–µ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –ø–æ–∏—Å–∫–∞ –≤ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –º–µ—Ç–æ–¥–æ–º —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã—Ö –≤—Å—Ç–∞–≤–æ–∫.
          </p>
          <p>
            –ù–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∏ —à–∏—Ä–æ–∫–æ –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–π –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞—Ö –º–µ—Ç–æ–¥ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å–∏–º–≤–æ–ª–æ–≤ ‚Äì —Ö–µ—à-–∞–¥—Ä–µ—Å–∞—Ü–∏—è. –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∏ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–∞–±–ª. 7). –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ N —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≥–¥–µ N –∑–∞—Ä–∞–Ω–µ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ. –ú–µ—Ç–æ–¥ —Ö–µ—à-–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ —Å–∏–º–≤–æ–ª–∞ –≤ –∏–Ω–¥–µ–∫—Å —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ. –ò–Ω–¥–µ–∫—Å –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∏–º–≤–æ–ª–∞, —Ç.–µ. –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –Ω–∞–¥ –Ω–∏–º –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –ï—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª—Å—è –æ–±—ä–µ–∫—Ç –∞, —Ç–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –µ–≥–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º: –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–∂–µ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è —Ä–∞–Ω–µ–µ, —Ç–æ h(–∞) ‚Äì —è—á–µ–π–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –∞. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∞ —Ä–∞–Ω–µ–µ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è, —Ç–æ h(–∞) ‚Äì –ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞, –≤ –∫–æ—Ç–æ—Ä—É—é –∑–∞–Ω–æ—Å–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∞.
          </p>
          <p>
            –í–æ–∑–Ω–∏–∫–∞–µ—Ç, –æ–¥–Ω–∞–∫–æ, –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ —Å–æ–≤–ø–∞–¥–∞—é—Ç. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–ª–∏–∑–∏–µ–π. –û—á–µ–≤–∏–¥–Ω–æ, –≤ –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–º–µ—â—ë–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, —Ç–∞–∫ —á—Ç–æ –º—ã –¥–æ–ª–∂–Ω—ã –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏–º–µ—Ç—å —Ç–∞–∫—É—é —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–ª–∞ –±—ã –æ–±—ä–µ–∫—Ç—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø–æ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ, —Ç–∞–∫ —á—Ç–æ–±—ã –∫–æ–ª–ª–∏–∑–∏–∏ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ. –ù–æ –∏–∑–±–µ–∂–∞—Ç—å –∏—Ö —Å–æ–≤—Å–µ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∫–æ–ª–ª–∏–∑–∏–∏. –°—É—â–µ—Å—Ç–≤—É—é—Ç –¥–≤–∞ —Ç–∞–∫–∏—Ö —Å–ø–æ—Å–æ–±–∞ ‚Äì —Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫.
          </p>
        </section>

        <section className="chapter-section">
          <h2>3.2. –ú–ï–¢–û–î –¶–ï–ü–û–ß–ï–ö</h2>
          <p>
            –ú–µ—Ç–æ–¥ —Ü–µ–ø–æ—á–µ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É, —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ —Ä–∞–≤–Ω—ã 0, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —Ç–∞–±–ª–∏—Ü—É —Å–∏–º–≤–æ–ª–æ–≤, –≤–Ω–∞—á–∞–ª–µ –ø—É—Å—Ç—É—é, –∏ —É–∫–∞–∑–∞—Ç–µ–ª—å –£–ö, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–∏–º–≤–æ–ª–æ–≤. –≠–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–±–ª–∏—Ü—ã —Å–∏–º–≤–æ–ª–æ–≤ –∏–º–µ—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –°–ù–êIN, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å 0 –∏–ª–∏ –∞–¥—Ä–µ—Å –¥—Ä—É–≥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–∏–º–≤–æ–ª–æ–≤. –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –Ω–∞ —Ä–∏—Å. 15.
          </p>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 15.png" alt="–†–∏—Å—É–Ω–æ–∫ 15" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 15</p>
          </div>
          <p>
            –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω–∞—è –∫ —Å–∏–º–≤–æ–ª—É, –¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å —É–∫–∞–∑–∞—Ç–µ–ª—è –≤ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü–µ. –£–∫–∞–∑–∞—Ç–µ–ª—å –ª–∏–±–æ —Ä–∞–≤–µ–Ω 0, –ª–∏–±–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã —Å–∏–º–≤–æ–ª–æ–≤ —Å –¥–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏. –ü–æ–ª–µ –°–ù–êIN –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–≤—è–∑–∞—Ç—å –≤ —Ü–µ–ø–æ—á–∫—É —ç–ª–µ–º–µ–Ω—Ç—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É –∂–µ —Å–∞–º–æ–º—É —É–∫–∞–∑–∞—Ç–µ–ª—é. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç–∞–±–ª–∏—Ü—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∏—Å–∞—Ç—å —Å–∏–º–≤–æ–ª S1. –§—É–Ω–∫—Ü–∏—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å —ç–ª–µ–º–µ–Ω—Ç–∞ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä 4. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–π —è—á–µ–π–∫–∏ —Ä–∞–≤–Ω–æ 0. –¢–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–µ:
          </p>
          <ol>
            <li>–ü—Ä–∏–±–∞–≤–ª—è–µ–º 1 –∫ –£–ö.</li>
            <li>–í–Ω–æ—Å–∏–º —ç–ª–µ–º–µ–Ω—Ç (S1, –∑–Ω–∞—á–µ–Ω–∏–µ, 0) –≤ –ø–æ–∑–∏—Ü–∏—é —Ç–∞–±–ª–∏—Ü—ã —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é —É–∫–∞–∑—ã–≤–∞–µ—Ç –£–ö.</li>
            <li>–ó–∞–Ω–æ—Å–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –£–ö. –≤ —É–∫–∞–∑–∞—Ç–µ–ª—å 4 —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã.</li>
            <li>–ü–æ–∫–∞ –ø–æ—Å—Ç—É–ø–∞—é—Ç —Å–∏–º–≤–æ–ª—ã, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å—ã —Ä–∞–∑–Ω—ã—Ö —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, –æ–Ω–∏ –∑–∞–Ω–æ—Å—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º. –¢–∞–∫, –µ—Å–ª–∏ –º—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É —Å–∏–º–≤–æ–ª—ã S2, S3, S4, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –¥–∞—ë—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª–∏ 1, 3, 6, —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–º–µ—Ç –≤–∏–¥, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ —Ä–∏—Å. 16.</li>
          </ol>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 16.png" alt="–†–∏—Å—É–Ω–æ–∫ 16" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 16</p>
          </div>
          <p>
            –í –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤, –ø–æ—Å—Ç—É–ø–∏—Ç —Å–∏–º–≤–æ–ª S5, –∫–æ—Ç–æ—Ä—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏–π—Å—è —Ä–∞–Ω–µ–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ 6. –í–æ—Ç –∑–¥–µ—Å—å –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ–ª–µ CHAIN. –°–∏–º–≤–æ–ª S5 –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É —Å–∏–º–≤–æ–ª–æ–≤ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –∫–æ–Ω—Ü—É —Ü–µ–ø–æ—á–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è (—Ä–∏—Å. 17).
          </p>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 17.png" alt="–†–∏—Å—É–Ω–æ–∫ 17" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 17</p>
          </div>
          <p>
            –í–Ω–µ—Å–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É —Å–∏–º–≤–æ–ª—ã S6, S7, S8, –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª–∏ 4, 3, 3 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ (—Ä–∏—Å. 18).
          </p>
          <div className="image-container">
            <img src="/images/—Ä–∏—Å 18.png" alt="–†–∏—Å—É–Ω–æ–∫ 18" className="chapter-image" />
            <p className="image-caption">–†–∏—Å. 18</p>
          </div>
        </section>

        <div className="questions-section">
          <button 
            className="questions-btn"
            onClick={() => setShowQuestions(!showQuestions)}
          >
            {showQuestions ? '‚ñº' : '‚ñ∂'} –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
          </button>
          
          {showQuestions && (
            <div className="questions-content">
              <ol className="questions-list">
                {questions.map((question, index) => (
                  <li key={index}>{question}</li>
                ))}
              </ol>
            </div>
          )}

          <button className="btn test-btn" onClick={openTest}>
            –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
          </button>
        </div>

        {isTestOpen && (
          <div className="test-modal-overlay" onClick={handleCloseTest}>
            <div className="test-modal" onClick={(e) => e.stopPropagation()}>
              <div className="test-modal-header">
                <h2>–¢–µ—Å—Ç –ø–æ —Ç–µ–º–µ ¬´–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü —Å–∏–º–≤–æ–ª–æ–≤¬ª</h2>
                <button className="close-btn" onClick={handleCloseTest}>√ó</button>
              </div>

              <div className="test-music-control">
                <button
                  className={`music-btn ${isMusicPlaying ? 'playing' : ''}`}
                  onClick={handleMusicToggle}
                >
                  {isMusicPlaying ? 'üîä –ú—É–∑—ã–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞' : 'üîá –ú—É–∑—ã–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞'}
                </button>
              </div>

              <div className="test-content">
                {testQuestions.map((q) => {
                  const isMultiple = Array.isArray(q.correct) && q.correct.length > 1
                  const selected = selectedAnswers[q.id]
                  const shuffledOptions = shuffledOptionsByQuestionId[q.id] || Object.entries(q.options)
                  return (
                    <div key={q.id} className="test-question">
                      <h3>{q.id}. {q.question}</h3>
                      <div className="test-options">
                        {shuffledOptions.map(([key, value]) => {
                          const isSelected = isMultiple
                            ? Array.isArray(selected) && selected.includes(key)
                            : selected === key
                          const isCorrect = q.correct.includes(key)
                          const showAnswer = showResults
                          return (
                            <label
                              key={key}
                              className={`test-option ${isSelected ? 'selected' : ''} ${showAnswer && isCorrect ? 'correct' : ''} ${showAnswer && isSelected && !isCorrect ? 'incorrect' : ''}`}
                            >
                              <input
                                type={isMultiple ? 'checkbox' : 'radio'}
                                name={`question-${q.id}`}
                                value={key}
                                checked={isSelected}
                                onChange={() =>
                                  isMultiple
                                    ? handleAnswerToggle(q.id, key)
                                    : handleAnswerSelect(q.id, key)
                                }
                                disabled={showResults}
                              />
                              <span>{value}</span>
                              {showAnswer && isCorrect && <span className="correct-mark">‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</span>}
                            </label>
                          )
                        })}
                      </div>
                    </div>
                  )
                })}
              </div>

              <div className="test-footer">
                {!showResults ? (
                  <button
                    className="btn submit-btn"
                    onClick={handleSubmitTest}
                    disabled={!allAnswered}
                  >
                    –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
                  </button>
                ) : (
                  <div className="test-results">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h3>
                    <p className="test-score">
                      –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {getScore()} –∏–∑ {testQuestions.length}
                    </p>
                    <p className="test-percentage">
                      {Math.round((getScore() / testQuestions.length) * 100)}%
                    </p>
                    <button className="btn" onClick={handleCloseTest}>
                      –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
        
        <div className="chapter-navigation">
          <Link to="/" className="btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</Link>
        </div>
      </div>
    </div>
  )
}

export default Chapter3


